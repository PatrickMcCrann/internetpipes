<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internet Pipes Events Dashboard</title>
    
    <!-- Load dependencies with specific versions and integrity checks -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/Recharts.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        html, body { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            width: 100%; 
        }
        #root { 
            width: 100%; 
            height: 100%; 
            padding: 20px; 
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // First check if all dependencies are loaded
        console.log('React version:', React.version);
        console.log('Recharts:', window.Recharts);

        const EventsAnalysis = () => {
            if (!window.Recharts) {
                return <div>Loading charts library...</div>;
            }

            const eventData = [
                { month: 'Jan 2024', digital: 1, inPerson: 1, digitalParticipants: 447, inPersonParticipants: 31 },
                { month: 'Feb 2024', digital: 6, inPerson: 4, digitalParticipants: 1406, inPersonParticipants: 65 },
                { month: 'Mar 2024', digital: 2, inPerson: 2, digitalParticipants: 504, inPersonParticipants: 87 },
                { month: 'Apr 2024', digital: 2, inPerson: 2, digitalParticipants: 150, inPersonParticipants: 40 },
                { month: 'May 2024', digital: 2, inPerson: 3, digitalParticipants: 411, inPersonParticipants: 69 },
                { month: 'Jun 2024', digital: 0, inPerson: 8, digitalParticipants: 0, inPersonParticipants: 200 },
                { month: 'Jul 2024', digital: 0, inPerson: 6, digitalParticipants: 0, inPersonParticipants: 132 },
                { month: 'Aug 2024', digital: 0, inPerson: 5, digitalParticipants: 0, inPersonParticipants: 45 },
                { month: 'Sep 2024', digital: 1, inPerson: 3, digitalParticipants: 110, inPersonParticipants: 21 },
                { month: 'Oct 2024', digital: 2, inPerson: 5, digitalParticipants: 404, inPersonParticipants: 33 },
                { month: 'Nov 2024', digital: 4, inPerson: 3, digitalParticipants: 523, inPersonParticipants: 30 },
                { month: 'Dec 2024', digital: 1, inPerson: 4, digitalParticipants: 79, inPersonParticipants: 27 },
                { month: 'Jan 2025', digital: 0, inPerson: 4, digitalParticipants: 0, inPersonParticipants: 10 },
                { month: 'Mar 2025', digital: 0, inPerson: 1, digitalParticipants: 0, inPersonParticipants: 0 }
            ];

            const totalStats = eventData.reduce((acc, month) => ({
                digital: acc.digital + month.digital,
                inPerson: acc.inPerson + month.inPerson,
                total: acc.total + month.digital + month.inPerson,
                digitalParticipants: acc.digitalParticipants + month.digitalParticipants,
                inPersonParticipants: acc.inPersonParticipants + month.inPersonParticipants
            }), { digital: 0, inPerson: 0, total: 0, digitalParticipants: 0, inPersonParticipants: 0 });

            const { BarChart, Bar, XAxis, YAxis, Tooltip, Legend, ResponsiveContainer } = window.Recharts;

            return (
                <div className="w-full h-full bg-white">
                    <div className="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
                        <div className="p-4 bg-blue-50 rounded-lg">
                            <div className="text-2xl font-bold">{totalStats.digital}</div>
                            <div className="text-sm text-gray-600">Digital Events</div>
                        </div>
                        <div className="p-4 bg-green-50 rounded-lg">
                            <div className="text-2xl font-bold">{totalStats.inPerson}</div>
                            <div className="text-sm text-gray-600">In-Person Events</div>
                        </div>
                        <div className="p-4 bg-purple-50 rounded-lg">
                            <div className="text-2xl font-bold">{totalStats.total}</div>
                            <div className="text-sm text-gray-600">Total Events</div>
                        </div>
                        <div className="p-4 bg-blue-100 rounded-lg">
                            <div className="text-2xl font-bold">{totalStats.digitalParticipants}</div>
                            <div className="text-sm text-gray-600">Digital Participants</div>
                        </div>
                        <div className="p-4 bg-green-100 rounded-lg">
                            <div className="text-2xl font-bold">{totalStats.inPersonParticipants}</div>
                            <div className="text-sm text-gray-600">In-Person Participants</div>
                        </div>
                    </div>

                    <div className="h-96 mb-8">
                        <h3 className="text-xl font-bold mb-4">Event Count by Month</h3>
                        <ResponsiveContainer width="100%" height="100%">
                            <BarChart data={eventData}>
                                <XAxis dataKey="month" angle={-45} textAnchor="end" height={60} />
                                <YAxis />
                                <Tooltip />
                                <Legend />
                                <Bar dataKey="digital" name="Digital Events" fill="#3b82f6" />
                                <Bar dataKey="inPerson" name="In-Person Events" fill="#22c55e" />
                            </BarChart>
                        </ResponsiveContainer>
                    </div>

                    <div className="h-96">
                        <h3 className="text-xl font-bold mb-4">Participation by Month</h3>
                        <ResponsiveContainer width="100%" height="100%">
                            <BarChart data={eventData}>
                                <XAxis dataKey="month" angle={-45} textAnchor="end" height={60} />
                                <YAxis />
                                <Tooltip />
                                <Legend />
                                <Bar dataKey="digitalParticipants" name="Digital Participants" fill="#93c5fd" />
                                <Bar dataKey="inPersonParticipants" name="In-Person Participants" fill="#86efac" />
                            </BarChart>
                        </ResponsiveContainer>
                    </div>
                </div>
            );
        };

        // Add error boundary
        window.addEventListener('error', function(e) {
            console.error('Runtime error:', e);
        });

        // Render with error handling
        try {
            ReactDOM.render(<EventsAnalysis />, document.getElementById('root'));
        } catch (e) {
            console.error('Render error:', e);
            document.getElementById('root').innerHTML = 'Error loading dashboard. Check console for details.';
        }
    </script>
</body>
</html>
